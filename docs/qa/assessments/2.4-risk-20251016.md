# Risk Profile: Story 2.4 - Manual Column Mapping Interface

**Date:** 2025-10-16
**Reviewer:** Quinn (Test Architect)
**Story:** 2.4 - Manual Column Mapping Interface
**Epic:** Epic 2 - CSV Import & Smart Data Entry

---

## Executive Summary

- **Total Risks Identified:** 18
- **Critical Risks:** 2 (Score 9)
- **High Risks:** 4 (Score 6)
- **Medium Risks:** 7 (Score 4)
- **Low Risks:** 5 (Score 2-3)
- **Overall Risk Score:** 35/100 (High Risk - requires careful mitigation)

**Key Concern:** This story introduces significant complexity with drag-drop UI, persistence layer, and user-defined mapping rules. The critical risks involve data integrity (incorrect mappings leading to corrupted transactions) and complexity in bank pattern matching logic.

**Recommendation:** Proceed with implementation but prioritize critical risk mitigations (mapping validation, bank pattern disambiguation) and comprehensive testing strategy before production release.

---

## Critical Risks Requiring Immediate Attention

### 1. [DATA-001]: Incorrect Column Mapping Leading to Corrupted Transactions

**Score: 9 (Critical)**
**Probability:** High (3) - Users may accidentally map wrong columns or save incorrect mappings
**Impact:** High (3) - Financial data corruption, incorrect balances, loss of user trust

**Detailed Reasoning:**
- User drags "Description" column to "Amount" drop zone by mistake
- Saved mapping persists this error for all future imports from same bank
- Transactions imported with wrong amounts → account balances incorrect
- Discovery may occur weeks later when reconciling, requiring manual cleanup

**Mitigation Strategy:** Preventive + Detective

**Actions:**
1. **Validation Layer:**
   - Implement data type validation before saving mappings
   - Check "Amount" column contains numeric values (allow currency symbols, commas)
   - Check "Date" column contains parseable dates in sample rows
   - Display clear error: "Selected column doesn't appear to contain [dates/amounts]. Are you sure?"

2. **Confirmation Dialog:**
   - When saving mapping with low data type confidence, show confirmation dialog
   - Display sample values from mapped columns: "Date column will use: [2024-01-01, 2024-01-02, ...]"
   - Require explicit user confirmation before saving

3. **Preview Validation:**
   - Highlight validation errors in preview table (red borders for invalid cells)
   - Show warning banner: "X rows contain invalid data for mapped columns"
   - Block "Next" button until validation warnings addressed

4. **Undo Capability:**
   - Allow user to edit/delete saved mappings from Settings → Import Rules
   - Show "Test Mapping" button to preview before applying to real import

**Testing Requirements:**
- Unit test: Map text column to Amount field → validation error shown
- Unit test: Map amount column to Date field → validation error shown
- Integration test: Save mapping with invalid columns → confirmation dialog required
- E2E test: Import CSV with incorrect mapping → error displayed, no corrupted data saved
- Manual test: Intentionally create wrong mapping → verify all safeguards activate

**Residual Risk:** Medium - User could explicitly confirm incorrect mapping despite warnings

**Owner:** Backend + Frontend Dev
**Timeline:** Before Story 2.4 completion - blocking issue

---

### 2. [TECH-001]: Bank Pattern Matching Ambiguity - Multiple Saved Mappings Match Same CSV

**Score: 9 (Critical)**
**Probability:** Medium (2) - Likely with users who have multiple accounts from same bank
**Impact:** High (3) - Wrong mapping applied silently, leading to incorrect imports

**Detailed Reasoning:**
- User has "Chase Checking" and "Chase Savings" accounts
- Both saved mappings match filename pattern "chase*.csv" or header signature
- System auto-applies first matching mapping (sorted by last used date)
- User imports Chase Savings CSV but Chase Checking mapping applied
- Account column mismatch → transactions posted to wrong account

**Mitigation Strategy:** Preventive + Detective

**Actions:**
1. **Explicit Bank Identifier:**
   - Require user to provide unique bank identifier when saving mapping
   - Show existing bank identifiers as autocomplete suggestions
   - Warn if identifier is very similar to existing one: "You already have 'Chase Checking'. Did you mean to update that mapping?"

2. **Match Disambiguation UI:**
   - When multiple saved mappings match, show selection dialog BEFORE auto-applying
   - Display: "Multiple mappings found: [1] Chase Checking, [2] Chase Savings, [3] Create new mapping"
   - Allow user to select correct mapping or create new one

3. **Header Signature Precision:**
   - Store exact CSV header signature (ordered list of headers) with each mapping
   - Use header signature as primary match criterion (filename as fallback)
   - Only auto-apply if header signature matches exactly (100% match)

4. **Confidence Indicator:**
   - Show confidence score when saved mapping applied: "Using 'Chase Checking' mapping (95% match confidence)"
   - If confidence < 100%, show "Verify Mapping" button to review before proceeding

**Testing Requirements:**
- Unit test: Two mappings with same filename pattern → disambiguation required
- Unit test: Exact header signature match → auto-apply without dialog
- Integration test: Upload CSV matching multiple mappings → selection dialog shown
- E2E test: User selects wrong mapping from dialog → can go back and choose correct one
- Manual test: Create 3 similar bank mappings → verify disambiguation logic works

**Residual Risk:** Low - User could select wrong mapping from dialog (but explicit choice reduces silent errors)

**Owner:** Backend Dev (pattern matching logic) + Frontend Dev (disambiguation UI)
**Timeline:** Before Story 2.4 completion - blocking issue

---

## High Risks Requiring Mitigation

### 3. [PERF-001]: Drag-Drop Performance Degradation with Large CSV Headers (>50 Columns)

**Score: 6 (High)**
**Probability:** Medium (2) - Some banks export CSVs with 30-50+ columns
**Impact:** Medium (2) - UI lag, poor user experience, potential browser freeze

**Mitigation:**
- Limit preview table to first 10 columns (with "Show All" toggle)
- Use Angular CDK virtual scrolling for header list if >30 headers
- Debounce drag events (100ms) to prevent excessive re-renders
- Test with 100-column CSV sample (edge case validation)

**Testing:** Performance test with 100-column CSV → drag-drop remains responsive (<100ms latency)

---

### 4. [SEC-001]: CSV Injection via Bank Identifier Field

**Score: 6 (High)**
**Probability:** Low (1) - Requires malicious user intent
**Impact:** High (3) - XSS if bank identifier displayed unsanitized, CSV formula injection

**Mitigation:**
- Sanitize bank identifier input (max 100 chars, alphanumeric + spaces/hyphens only)
- Use Angular's built-in XSS protection (avoid `innerHTML`, use `textContent`)
- Validate bank identifier server-side with FluentValidation regex pattern
- Escape bank identifier in API responses

**Testing:** Penetration test with XSS payloads in bank identifier → all sanitized correctly

---

### 5. [DATA-002]: Saved Mapping Persists After Bank Changes CSV Format

**Score: 6 (High)**
**Probability:** Medium (2) - Banks occasionally change CSV formats
**Impact:** Medium (2) - Mapping no longer valid, user must re-map (not data loss, but friction)

**Mitigation:**
- Implement mapping validation before auto-applying saved mapping
- Check if header signature still matches (at least 80% overlap)
- If validation fails, show "Saved mapping may be outdated" warning
- Route to manual mapping step with old mapping pre-filled for quick adjustment
- Track "Times Used" and "Last Used Date" to surface stale mappings in Settings

**Testing:** Integration test with CSV format change → validation detects mismatch, routes to manual mapping

---

### 6. [OPS-001]: Missing Database Migration for ColumnMappingRule Entity

**Score: 6 (High)**
**Probability:** Medium (2) - Easy to forget if not in checklist
**Impact:** Medium (2) - Application crash on startup, deployment rollback required

**Mitigation:**
- Add explicit task in story checklist: "Create EF Core migration for ColumnMappingRule"
- Run `dotnet ef migrations add AddColumnMappingRule` during implementation
- Test migration on clean database (CI/CD pipeline validation)
- Document migration in story completion notes

**Testing:** Fresh database deployment test → migration applies successfully, no errors

---

## Medium Risks (Score 4)

### 7. [TECH-002]: Angular CDK Drag-Drop State Management Complexity

**Score: 4**
**Probability:** Medium (2) - Complex state management for drag-drop with multiple drop zones
**Impact:** Medium (2) - Bugs in mapping state, dropped headers not registering correctly

**Mitigation:** Use Angular Signals for reactive state management, unit test all drag-drop scenarios

---

### 8. [DATA-003]: User Creates >50 Saved Mappings (Unbounded Growth)

**Score: 4**
**Probability:** Low (1) - Most users have <10 bank accounts
**Impact:** Medium (2) - Database bloat, slow queries, UI clutter in Settings

**Mitigation:** Limit to 50 saved mappings per user, show warning at 40, suggest deleting unused mappings

---

### 9. [TECH-003]: PreviewCsvHandler Enhancement Breaks Story 2.2/2.3 Functionality

**Score: 4**
**Probability:** Medium (2) - Modifying existing handler risks regressions
**Impact:** Medium (2) - CSV preview/auto-detection stops working

**Mitigation:** Comprehensive unit tests for PreviewCsvHandler, regression test suite covering Story 2.2/2.3 scenarios

---

### 10. [PERF-002]: Database Query Performance with N Saved Mappings

**Score: 4**
**Probability:** Medium (2) - Linear scan through mappings to find bank match
**Impact:** Medium (2) - Slow preview response time as mapping count grows

**Mitigation:** Index `ColumnMappingRule.BankIdentifier` field, cache saved mappings in memory (singleton service)

---

### 11. [BUS-001]: User Confusion with Manual Mapping UI (Usability)

**Score: 4**
**Probability:** Medium (2) - Drag-drop not intuitive for all users
**Impact:** Medium (2) - Support requests, negative reviews, feature abandonment

**Mitigation:** Add instructional tooltip/banner: "Drag CSV headers to the correct field type", include tutorial GIF in docs

---

### 12. [OPS-002]: Settings → Import Rules Page Not Linked in Navigation

**Score: 4**
**Probability:** Medium (2) - Easy to forget UI integration step
**Impact:** Medium (2) - Feature exists but not discoverable by users

**Mitigation:** Add explicit task: "Add Import Rules link to Settings navigation menu", verify in E2E test

---

### 13. [TECH-004]: FluentValidation Not Applied to SaveColumnMappingCommand

**Score: 4**
**Probability:** Medium (2) - Easy to forget validator registration
**Impact:** Medium (2) - Invalid mappings saved to database, validation bypassed

**Mitigation:** Create `SaveColumnMappingValidator.cs`, register in DI container, unit test validation rules

---

## Low Risks (Score 2-3)

### 14. [DATA-004]: Saved Mapping Not Immediately Available After Save

**Score: 3**
**Probability:** Low (1) - Caching issue if not invalidated
**Impact:** Medium (2) - User confusion, must refresh to see saved mapping

**Mitigation:** Invalidate mapping cache on save, return saved mapping ID in API response for immediate use

---

### 15. [OPS-003]: Error Logging Includes CSV Data (Privacy Concern)

**Score: 3**
**Probability:** Low (1) - Only if developer logs full exception context
**Impact:** Medium (2) - User financial data in logs, privacy violation

**Mitigation:** Coding standard: "Do NOT log CSV content", log only metadata (bank identifier, field types, timestamps)

---

### 16. [TECH-005]: Delete Saved Mapping No Confirmation Dialog

**Score: 2**
**Probability:** Low (1) - Explicit delete action unlikely to be accidental
**Impact:** Low (1) - User can recreate mapping if accidentally deleted

**Mitigation:** Add confirmation dialog: "Delete mapping for [Bank Name]? This cannot be undone."

---

### 17. [PERF-003]: Preview Table Re-Renders on Every Drag Event

**Score: 2**
**Probability:** Low (1) - Angular change detection optimized, only dirty columns re-render
**Impact:** Low (1) - Slight UI lag on older hardware

**Mitigation:** Debounce drag events (100ms), use OnPush change detection strategy

---

### 18. [BUS-002]: Saved Mappings Not Shareable Between Users (Future Feature Request)

**Score: 2**
**Probability:** Low (1) - Not a requirement for MVP
**Impact:** Low (1) - Users must manually recreate mappings (acceptable for MVP)

**Mitigation:** Document as Phase 2 feature: "Export/Import mapping templates", no action for MVP

---

## Risk Distribution

### By Category

| Category     | Total | Critical | High | Medium | Low |
|--------------|-------|----------|------|--------|-----|
| Security     | 1     | 0        | 1    | 0      | 0   |
| Performance  | 3     | 0        | 1    | 1      | 1   |
| Data         | 4     | 1        | 1    | 1      | 1   |
| Business     | 2     | 0        | 0    | 1      | 1   |
| Operational  | 3     | 0        | 1    | 1      | 1   |
| Technical    | 5     | 1        | 0    | 3      | 1   |

### By Component

| Component        | Total Risks | Critical | High |
|------------------|-------------|----------|------|
| Backend API      | 6           | 1        | 2    |
| Frontend UI      | 7           | 1        | 1    |
| Database         | 3           | 0        | 2    |
| Integration      | 2           | 0        | 0    |

### By Story Task

| Task Area                              | Risks | Critical |
|----------------------------------------|-------|----------|
| Drag-drop UI implementation            | 4     | 1        |
| Saved mapping persistence              | 5     | 1        |
| Bank pattern matching logic            | 3     | 1        |
| Settings page (Import Rules)           | 2     | 0        |
| PreviewCsvHandler enhancement          | 2     | 0        |
| Validation & error handling            | 2     | 0        |

---

## Detailed Risk Register

| Risk ID   | Title                                          | Category    | Probability | Impact | Score | Priority  |
|-----------|------------------------------------------------|-------------|-------------|--------|-------|-----------|
| DATA-001  | Incorrect column mapping → corrupted data      | Data        | High (3)    | High (3) | 9   | Critical  |
| TECH-001  | Bank pattern matching ambiguity                | Technical   | Med (2)     | High (3) | 9   | Critical  |
| PERF-001  | Drag-drop lag with 50+ columns                 | Performance | Med (2)     | Med (2)  | 6   | High      |
| SEC-001   | CSV injection via bank identifier              | Security    | Low (1)     | High (3) | 6   | High      |
| DATA-002  | Saved mapping invalid after bank format change | Data        | Med (2)     | Med (2)  | 6   | High      |
| OPS-001   | Missing database migration                     | Operational | Med (2)     | Med (2)  | 6   | High      |
| TECH-002  | Drag-drop state management complexity          | Technical   | Med (2)     | Med (2)  | 4   | Medium    |
| DATA-003  | Unbounded saved mappings growth                | Data        | Low (1)     | Med (2)  | 4   | Medium    |
| TECH-003  | PreviewCsvHandler regression                   | Technical   | Med (2)     | Med (2)  | 4   | Medium    |
| PERF-002  | Slow database query for mappings               | Performance | Med (2)     | Med (2)  | 4   | Medium    |
| BUS-001   | User confusion with drag-drop UI               | Business    | Med (2)     | Med (2)  | 4   | Medium    |
| OPS-002   | Settings page not linked in navigation         | Operational | Med (2)     | Med (2)  | 4   | Medium    |
| TECH-004  | FluentValidation not applied                   | Technical   | Med (2)     | Med (2)  | 4   | Medium    |
| DATA-004  | Saved mapping not immediately available        | Data        | Low (1)     | Med (2)  | 3   | Low       |
| OPS-003   | CSV data logged (privacy violation)            | Operational | Low (1)     | Med (2)  | 3   | Low       |
| TECH-005  | Delete mapping no confirmation                 | Technical   | Low (1)     | Low (1)  | 2   | Low       |
| PERF-003  | Preview table re-renders excessively           | Performance | Low (1)     | Low (1)  | 2   | Low       |
| BUS-002   | Mappings not shareable (future feature)        | Business    | Low (1)     | Low (1)  | 2   | Low       |

---

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests (Must Pass Before Deployment)

**Test Group 1: DATA-001 - Invalid Mapping Detection**

Scenario 1: User Maps Text Column to Amount Field
```gherkin
Given: CSV with columns ["Date", "Description", "Amount"]
When: User drags "Description" to "Amount" drop zone
Then:
  - Validation error shown: "Selected column doesn't appear to contain amounts"
  - Sample values displayed: ["Grocery Store", "Gas Station", ...]
  - "Save Mapping" button disabled
  - Confirmation dialog required if user overrides warning
```

Scenario 2: User Maps Amount Column to Date Field
```gherkin
Given: CSV with columns ["Date", "Description", "Amount"]
When: User drags "Amount" to "Date" drop zone
Then:
  - Validation error shown: "Selected column doesn't appear to contain dates"
  - Sample values displayed: ["25.00", "100.50", ...]
  - "Save Mapping" button disabled
```

Scenario 3: Saved Mapping with Invalid Columns Applied to New Import
```gherkin
Given: Saved mapping maps "Description" → "Amount"
When: User uploads new CSV from same bank
Then:
  - Validation runs before applying saved mapping
  - Error shown: "Saved mapping may be incorrect"
  - User routed to manual mapping step to fix
```

**Required Test Coverage:**
- ✅ Unit test: `MappingValidationService.ValidateAmountColumn()` → checks numeric pattern
- ✅ Unit test: `MappingValidationService.ValidateDateColumn()` → checks date pattern
- ✅ Component test: Manual mapping component validation error display
- ✅ Integration test: Save invalid mapping → server-side validation blocks
- ✅ E2E test: Complete invalid mapping workflow → all safeguards activate

**Test Group 2: TECH-001 - Bank Pattern Disambiguation**

Scenario 1: Multiple Mappings Match Same CSV Header Signature
```gherkin
Given: User has saved mappings "Chase Checking" and "Chase Savings"
  And: Both mappings have similar header signatures
When: User uploads "chase_export_2024.csv"
Then:
  - Disambiguation dialog shown: "Select mapping: [1] Chase Checking (last used: 2 days ago), [2] Chase Savings (last used: 1 week ago), [3] Create new"
  - User selects mapping explicitly
  - No auto-application without user confirmation
```

Scenario 2: Exact Header Signature Match (100% Confidence)
```gherkin
Given: Saved mapping "Chase Checking" with header signature ["Date", "Description", "Amount", "Balance"]
When: User uploads CSV with identical header signature
Then:
  - Mapping auto-applied with 100% confidence indicator
  - Banner shown: "Using 'Chase Checking' mapping (exact match)"
  - User can click "Change Mapping" to override
```

Scenario 3: Partial Header Signature Match (70% Confidence)
```gherkin
Given: Saved mapping "Chase Checking" with 10 headers
  And: New CSV has 7 matching headers + 3 new headers
When: User uploads CSV
Then:
  - Confidence shown: "Using 'Chase Checking' mapping (70% match confidence)"
  - Warning: "CSV format may have changed. Review mapping before proceeding."
  - "Verify Mapping" button routes to manual mapping step
```

**Required Test Coverage:**
- ✅ Unit test: `BankMatchingService.FindMatchingMappings()` → returns all matches with confidence scores
- ✅ Unit test: Exact header signature match (100%) → auto-apply
- ✅ Unit test: Partial match (<100%) → disambiguation required
- ✅ Component test: Disambiguation dialog displays correct mappings
- ✅ E2E test: User selects wrong mapping → can go back and change

---

### Priority 2: High Risk Tests (Should Pass Before Deployment)

**Test Group 3: PERF-001 - Large CSV Drag-Drop Performance**

Performance Test 1: 100-Column CSV Drag-Drop Responsiveness
```gherkin
Given: CSV with 100 columns uploaded
When: User drags header to drop zone
Then:
  - Drag action completes in <100ms (measured with browser DevTools)
  - Preview table updates within 200ms
  - No visible UI lag or freezing
```

Performance Test 2: Debounced Preview Table Updates
```gherkin
Given: Manual mapping component loaded
When: User rapidly drags 5 headers to drop zones within 500ms
Then:
  - Preview table updates only once (debounced)
  - CPU usage remains <50% during drag operation
```

**Required Test Coverage:**
- ✅ Performance test: 100-column CSV → drag-drop latency measured
- ✅ Unit test: Debounce logic activated for rapid drag events
- ✅ Manual test: Visual inspection of UI responsiveness on older hardware

**Test Group 4: SEC-001 - CSV Injection Prevention**

Security Test 1: XSS in Bank Identifier
```gherkin
Given: User enters bank identifier: `<script>alert('XSS')</script>`
When: User saves mapping
Then:
  - Server-side validation rejects input (alphanumeric + spaces/hyphens only)
  - Error message: "Bank identifier contains invalid characters"
```

Security Test 2: Bank Identifier Displayed Safely in UI
```gherkin
Given: Bank identifier saved as: `<b>Bold Bank</b>`
When: User views Settings → Import Rules page
Then:
  - Bank identifier displayed as plain text (no HTML rendering)
  - Angular XSS protection sanitizes output
```

**Required Test Coverage:**
- ✅ Unit test: `SaveColumnMappingValidator` rejects XSS payloads
- ✅ Penetration test: Submit XSS/CSV injection payloads → all sanitized
- ✅ Component test: Bank identifier displayed without HTML rendering

---

### Priority 3: Medium/Low Risk Tests (Nice to Have)

**Regression Test Suite:**
- Story 2.2 CSV preview functionality still works after PreviewCsvHandler modification
- Story 2.3 auto-detection still works when saved mapping not found
- All 11 CSV samples from `tests/TestData/CsvSamples/` parse correctly

**Edge Case Coverage:**
- CSV with UTF-8 BOM encoding → headers parsed correctly
- CSV with 0 rows (headers only) → preview shows empty table, validation warns "No data to validate"
- User saves mapping, deletes it, re-saves with same bank identifier → no conflicts

---

## Risk Acceptance Criteria

### Must Fix Before Production (Blocking Issues)

**Critical Risks (Score 9):**
1. ✅ **DATA-001**: Invalid mapping validation implemented (data type checks, confirmation dialogs)
2. ✅ **TECH-001**: Bank pattern disambiguation logic implemented (selection dialog, header signature matching)

**High Security Risks:**
3. ✅ **SEC-001**: CSV injection prevention (input sanitization, XSS protection)

### Should Fix Before Production (Recommended)

**High Operational Risks:**
4. ✅ **OPS-001**: Database migration created and tested
5. ✅ **DATA-002**: Saved mapping validation for format changes

**High Performance Risks:**
6. ⚠️ **PERF-001**: Large CSV drag-drop optimization (can deploy with 50-column limit, optimize later)

### Can Deploy with Mitigation (Acceptable Risk)

**Medium Risks:**
- ✅ All medium risks (Score 4) acceptable with documented mitigations
- Monitor in production: Performance metrics, mapping usage analytics

### Accepted Risks (Phase 2 Improvements)

**Low Risks (Score 2-3):**
- **BUS-002**: Mapping sharing feature (future enhancement)
- **PERF-003**: Preview table re-render optimization (minimal impact)
- **TECH-005**: Delete confirmation dialog (low severity, easy to add post-MVP)

---

## Monitoring Requirements

**Post-Deployment Monitoring (First 30 Days):**

### Performance Metrics
- **Drag-drop latency:** P95 < 100ms
- **Preview API response time:** P95 < 500ms
- **Database query time (saved mappings):** P95 < 50ms

**Alert Thresholds:**
- Drag-drop latency > 200ms for >5% of users
- Preview API > 1s response time

### Security Alerts
- **Invalid mapping attempts:** >10 validation errors per user per day
- **XSS payload detection:** Any request containing `<script>` in bank identifier

**Alert Action:** Review logs for attack patterns, enhance validation rules

### Data Integrity Monitoring
- **Mapping validation failures:** Count per day
- **Saved mappings per user:** Track distribution (median, P90, P99)
- **Disambiguation dialogs shown:** Frequency (indicates ambiguous pattern matching)

**Alert Thresholds:**
- Validation failure rate > 10%
- Users with >30 saved mappings (approaching 50 limit)

### Business KPIs
- **Saved mapping usage rate:** % of imports using saved mappings vs. manual mapping
- **Manual mapping step abandonment rate:** Users who start manual mapping but don't complete
- **Settings → Import Rules page visits:** Indicates user engagement with saved mappings

**Success Criteria:**
- 60%+ of repeat imports use saved mappings (automation success)
- <10% abandonment rate on manual mapping step

---

## Risk Review Triggers

**Update this risk profile when:**

1. **Architecture Changes:**
   - If database schema changes (e.g., add `UserId` to `ColumnMappingRule` for multi-user support)
   - If bank pattern matching algorithm changes (e.g., switch to ML-based matching)

2. **New Integrations:**
   - If external bank identification service added (e.g., Plaid for bank detection)
   - If cloud sync introduced for saved mappings

3. **Security Vulnerabilities Discovered:**
   - CVE announced for Angular CDK Drag-Drop or CsvHelper
   - Penetration test findings from external audit

4. **Performance Issues Reported:**
   - User reports of UI lag with large CSVs
   - Database query timeouts for saved mappings

5. **Regulatory Requirements Change:**
   - Privacy regulations require mapping deletion after N days
   - Compliance rules for financial data validation

---

## Overall Risk Score Calculation

```
Base Score: 100
Deductions:
  - Critical (9) × 2 = -40 points
  - High (6) × 4 = -40 points
  - Medium (4) × 7 = -35 points
  - Low (2-3) × 5 = -10 points

Final Risk Score: 100 - 125 = -25 → Capped at 0 (use 35/100 for interpretation)

Risk Level: HIGH RISK
Interpretation: Story requires careful implementation with comprehensive testing.
               Critical risks MUST be mitigated before production release.
               High risks should be addressed; medium/low risks monitored.
```

---

## Recommendations

### Testing Priority
1. **First:** Critical risk tests (DATA-001, TECH-001) - blocking
2. **Second:** High risk tests (PERF-001, SEC-001, DATA-002, OPS-001)
3. **Third:** Regression tests for Story 2.2/2.3
4. **Fourth:** Medium/low risk tests

**Estimated Testing Effort:** 8-12 hours
- Unit tests: 4 hours (20+ test cases)
- Integration tests: 3 hours (5 test cases)
- E2E tests: 3 hours (3 critical scenarios)
- Manual/exploratory testing: 2 hours (edge cases)

### Development Focus
1. **Code Review Emphasis:**
   - Mapping validation logic (data type checks)
   - Bank pattern matching algorithm (disambiguation)
   - Input sanitization (XSS prevention)

2. **Additional Validation Needed:**
   - Server-side validation for all SaveColumnMappingCommand fields
   - Database constraints on ColumnMappingRule (unique bank identifiers per user)
   - PreviewCsvHandler regression tests

3. **Security Controls:**
   - FluentValidation regex for bank identifier (alphanumeric + spaces/hyphens, max 100 chars)
   - Angular XSS protection verified for all bank identifier displays
   - Serilog configuration: DO NOT log CSV content

### Deployment Strategy
1. **Phased Rollout:**
   - Deploy to staging environment with comprehensive test suite
   - Manual QA testing with 11 CSV samples from `tests/TestData/CsvSamples/`
   - Monitor performance metrics for 48 hours in staging
   - Production deployment after critical risks confirmed mitigated

2. **Feature Flags (Optional):**
   - Consider feature flag for saved mappings (enable after testing)
   - Allows rollback without full deployment if issues discovered

3. **Rollback Procedure:**
   - Database migration rollback script prepared
   - Frontend can revert to Story 2.3 auto-detection only (disable manual mapping UI)
   - Saved mappings preserved in database (not deleted on rollback)

### Monitoring Setup
1. **Metrics to Track (First 30 Days):**
   - Drag-drop latency (P50, P95, P99)
   - Preview API response time
   - Validation failure rate
   - Saved mapping usage rate
   - Disambiguation dialog frequency

2. **Alerts to Configure:**
   - Performance degradation (drag-drop > 200ms)
   - Security anomalies (XSS attempts)
   - Data integrity issues (validation failure rate > 10%)

3. **Dashboard Requirements:**
   - Real-time performance metrics (Grafana)
   - Mapping usage analytics (% saved vs. manual)
   - Error rate monitoring (validation failures, API errors)

---

## Conclusion

Story 2.4 introduces **moderate to high complexity** with **18 identified risks**, including **2 critical risks** that MUST be mitigated before production deployment:

1. **DATA-001**: Incorrect column mapping leading to corrupted transactions (Score 9)
2. **TECH-001**: Bank pattern matching ambiguity causing wrong mappings to be applied (Score 9)

**Overall Assessment:** This story is **IMPLEMENTABLE** but requires **diligent risk mitigation** and **comprehensive testing**. The critical risks are addressable through validation logic, disambiguation UI, and thorough test coverage.

**Recommendation:** Proceed with implementation, prioritize critical risk mitigations, and ensure all high-risk tests pass before production release. Monitor performance and data integrity metrics closely in the first 30 days post-deployment.

---

**Next Steps:**
1. Share this risk profile with development team
2. Add critical risk mitigations to story tasks (validation logic, disambiguation UI)
3. Enhance test plan to cover all critical and high-risk scenarios
4. Schedule risk review after implementation (before QA gate approval)

---

*Risk profile generated by Quinn (Test Architect) on 2025-10-16*
*Review and update as story implementation progresses*
