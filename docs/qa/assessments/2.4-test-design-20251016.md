# Test Design: Story 2.4 - Manual Column Mapping Interface

**Date:** 2025-10-16
**Designer:** Quinn (Test Architect)
**Story:** 2.4 - Manual Column Mapping Interface
**Epic:** Epic 2 - CSV Import & Smart Data Entry

---

## Test Strategy Overview

- **Total Test Scenarios:** 47
- **Unit Tests:** 26 (55%)
- **Integration Tests:** 14 (30%)
- **E2E Tests:** 7 (15%)
- **Priority Distribution:**
  - **P0 (Critical):** 18 tests (38%)
  - **P1 (High):** 16 tests (34%)
  - **P2 (Medium):** 9 tests (19%)
  - **P3 (Low):** 4 tests (9%)

**Testing Strategy Rationale:**

This story introduces significant complexity with drag-drop UI, persistence layer, and pattern matching logic. The test strategy emphasizes:

1. **Unit-heavy approach** (55%) for validation logic, bank pattern matching, and business rules
2. **Targeted integration tests** (30%) for database operations and API contracts
3. **Focused E2E tests** (15%) for critical user journeys (drag-drop workflow, saved mapping application)

**Risk-Based Testing:**
Test design prioritizes critical risks identified in risk profile ([2.4-risk-20251016.md](2.4-risk-20251016.md)):
- **DATA-001**: Invalid mapping validation (9 P0 unit tests)
- **TECH-001**: Bank pattern disambiguation (6 P0 tests across all levels)
- **PERF-001**: Large CSV performance (2 P1 performance tests)
- **SEC-001**: Input sanitization (3 P0 security tests)

---

## Test Scenarios by Acceptance Criteria

### AC1: Drag-drop UI displays CSV headers as draggable pills (FR3)

**Risk Coverage:** BUS-001 (User confusion), TECH-002 (State management complexity)

#### Scenarios

| Test ID       | Level       | Priority | Test Description                               | Justification                                    |
|---------------|-------------|----------|------------------------------------------------|--------------------------------------------------|
| 2.4-UNIT-001  | Unit        | P1       | Component renders CSV headers as Material chips | Pure rendering logic, no external dependencies   |
| 2.4-UNIT-002  | Unit        | P1       | Headers array properly mapped to draggable items | Data transformation logic                        |
| 2.4-UNIT-003  | Unit        | P2       | Large header list (100 columns) renders correctly | Edge case validation                            |
| 2.4-INT-001   | Integration | P1       | Drag-drop state updates when header dragged    | Angular CDK Drag-Drop integration                |
| 2.4-E2E-001   | E2E         | P1       | User sees CSV headers as draggable pills       | Visual validation of critical UI element         |

**Coverage:** 5 tests (2 unit P1, 1 unit P2, 1 integration P1, 1 E2E P1)

---

### AC2: Drop zones for Date, Amount, Payee, Memo, Account (optional)

**Risk Coverage:** TECH-002 (State management), BUS-001 (Usability)

#### Scenarios

| Test ID       | Level       | Priority | Test Description                                  | Justification                                   |
|---------------|-------------|----------|---------------------------------------------------|-------------------------------------------------|
| 2.4-UNIT-004  | Unit        | P1       | Drop zones render with correct labels             | Component initialization logic                  |
| 2.4-UNIT-005  | Unit        | P1       | Required drop zones marked visually (Date, Amount)| Validation UX logic                             |
| 2.4-UNIT-006  | Unit        | P1       | Optional drop zones allow empty state             | Business rule: optional fields                  |
| 2.4-INT-002   | Integration | P1       | Drop event updates mapping state correctly        | CDK Drag-Drop integration with component state  |
| 2.4-INT-003   | Integration | P2       | Multiple drops to same zone replace previous value| State management edge case                      |
| 2.4-E2E-002   | E2E         | P1       | User drags header to drop zone successfully       | Critical user interaction                       |

**Coverage:** 6 tests (3 unit P1, 1 integration P1, 1 integration P2, 1 E2E P1)

---

### AC3: Preview table shows first 5 rows with mapped columns highlighted

**Risk Coverage:** PERF-003 (Preview re-renders)

#### Scenarios

| Test ID       | Level       | Priority | Test Description                                     | Justification                                  |
|---------------|-------------|----------|------------------------------------------------------|------------------------------------------------|
| 2.4-UNIT-007  | Unit        | P1       | Preview table renders first 5 sample rows            | Data slicing logic                             |
| 2.4-UNIT-008  | Unit        | P1       | Mapped columns show color-coded badges in header     | Highlighting logic                             |
| 2.4-UNIT-009  | Unit        | P1       | Badge color matches field type (Date=blue, Amount=green) | Visual consistency business rule           |
| 2.4-UNIT-010  | Unit        | P2       | Preview updates dynamically on mapping change        | Reactive state logic with Signals              |
| 2.4-INT-004   | Integration | P2       | Debounced preview updates prevent excessive renders  | Performance optimization validation            |
| 2.4-E2E-003   | E2E         | P1       | Preview table highlights mapped columns after drag   | Visual feedback validation                     |

**Coverage:** 6 tests (4 unit: 3 P1 + 1 P2, 1 integration P2, 1 E2E P1)

---

### AC4: Validation errors shown if required columns (Date, Amount) not mapped

**Risk Coverage:** DATA-001 (Critical - Incorrect mapping validation)

#### Scenarios

| Test ID       | Level       | Priority | Test Description                                                | Justification                                         |
|---------------|-------------|----------|-----------------------------------------------------------------|-------------------------------------------------------|
| 2.4-UNIT-011  | Unit        | **P0**   | **Validation fails if Date column not mapped**                  | **Critical data integrity rule**                      |
| 2.4-UNIT-012  | Unit        | **P0**   | **Validation fails if Amount column not mapped**                | **Critical data integrity rule**                      |
| 2.4-UNIT-013  | Unit        | **P0**   | **Validation passes if all required columns mapped**            | **Happy path validation**                             |
| 2.4-UNIT-014  | Unit        | **P0**   | **Date column validation: detects text column as invalid**      | **DATA-001 mitigation: data type validation**         |
| 2.4-UNIT-015  | Unit        | **P0**   | **Amount column validation: detects text column as invalid**    | **DATA-001 mitigation: data type validation**         |
| 2.4-UNIT-016  | Unit        | **P0**   | **Date column validation: accepts date patterns (YYYY-MM-DD)**  | **DATA-001 mitigation: positive validation**          |
| 2.4-UNIT-017  | Unit        | **P0**   | **Amount column validation: accepts numeric values**            | **DATA-001 mitigation: positive validation**          |
| 2.4-UNIT-018  | Unit        | P1       | Error message displayed for missing required fields             | User feedback logic                                   |
| 2.4-UNIT-019  | Unit        | P1       | Drop zone shows red border when validation error present        | Visual error indication                               |
| 2.4-INT-005   | Integration | **P0**   | **Server-side validation rejects mapping with missing Date**    | **Critical: defense in depth**                        |
| 2.4-INT-006   | Integration | **P0**   | **Server-side validation rejects invalid data type mappings**   | **DATA-001 mitigation: backend validation**           |
| 2.4-E2E-004   | E2E         | **P0**   | **User attempts to save without required mappings â†’ error shown** | **Critical user workflow validation**               |

**Coverage:** 12 tests (**9 P0** critical, 2 P1, 1 P2) - **Highest concentration due to DATA-001 risk**

---

### AC5: "Save Mapping" button stores rule for future imports from same bank

**Risk Coverage:** TECH-001 (Bank pattern ambiguity), DATA-002 (Stale mappings), DATA-003 (Unbounded growth)

#### Scenarios

| Test ID       | Level       | Priority | Test Description                                                     | Justification                                      |
|---------------|-------------|----------|----------------------------------------------------------------------|----------------------------------------------------|
| 2.4-UNIT-020  | Unit        | **P0**   | **SaveColumnMappingCommand validates bank identifier not empty**     | **Critical: prevent invalid saves**                |
| 2.4-UNIT-021  | Unit        | **P0**   | **SaveColumnMappingCommand validates required fields present**       | **Critical: data integrity**                       |
| 2.4-UNIT-022  | Unit        | **P0**   | **Bank identifier sanitized for XSS (SEC-001 mitigation)**           | **Critical: security vulnerability**               |
| 2.4-UNIT-023  | Unit        | P1       | Bank identifier max length enforced (100 chars)                      | Input validation rule                              |
| 2.4-UNIT-024  | Unit        | P1       | Header signature stored with exact column order                      | TECH-001 mitigation: precise matching              |
| 2.4-UNIT-025  | Unit        | P2       | Duplicate bank identifier warning shown to user                      | Usability enhancement                              |
| 2.4-INT-007   | Integration | **P0**   | **SaveColumnMappingHandler persists mapping to database**            | **Critical: data persistence**                     |
| 2.4-INT-008   | Integration | **P0**   | **Saved mapping retrievable by bank identifier**                     | **Critical: verify persistence works**             |
| 2.4-INT-009   | Integration | P1       | Update existing mapping when same bank identifier used               | TECH-001 mitigation: avoid duplicates              |
| 2.4-INT-010   | Integration | P1       | Mapping includes timestamps (CreatedAt, LastUsedAt)                  | DATA-002 mitigation: track staleness               |
| 2.4-INT-011   | Integration | P2       | Limit user to 50 saved mappings (DATA-003 mitigation)                | Prevent unbounded growth                           |
| 2.4-E2E-005   | E2E         | **P0**   | **User saves mapping â†’ success toast shown â†’ mapping persists**      | **Critical: complete save workflow**               |

**Coverage:** 12 tests (**6 P0** critical, 4 P1, 2 P2)

---

### AC6: Saved mappings accessible in Settings â†’ Import Rules

**Risk Coverage:** OPS-002 (Navigation not linked)

#### Scenarios

| Test ID       | Level       | Priority | Test Description                                          | Justification                                    |
|---------------|-------------|----------|-----------------------------------------------------------|--------------------------------------------------|
| 2.4-UNIT-026  | Unit        | P1       | ImportRules component renders saved mappings table        | Component rendering logic                        |
| 2.4-INT-012   | Integration | P1       | GetSavedMappingsQuery returns all user mappings           | API contract validation                          |
| 2.4-INT-013   | Integration | P1       | Delete mapping removes from database and returns success  | Deletion workflow                                |
| 2.4-INT-014   | Integration | P2       | Edit mapping opens dialog with pre-filled values          | Edit workflow validation                         |
| 2.4-E2E-006   | E2E         | P1       | User navigates to Settings â†’ Import Rules page            | Navigation validation (OPS-002 mitigation)       |
| 2.4-E2E-007   | E2E         | P2       | User deletes saved mapping â†’ confirmation dialog shown    | Complete deletion workflow                       |

**Coverage:** 6 tests (1 unit P1, 3 integration: 2 P1 + 1 P2, 2 E2E: 1 P1 + 1 P2)

---

## Additional Test Scenarios (Critical Risks Not in ACs)

### Bank Pattern Matching & Disambiguation (TECH-001 - Critical Risk Score 9)

**Risk:** Multiple saved mappings match same CSV, wrong mapping auto-applied

| Test ID       | Level       | Priority | Test Description                                                      | Justification                                   |
|---------------|-------------|----------|-----------------------------------------------------------------------|-------------------------------------------------|
| 2.4-UNIT-027  | Unit        | **P0**   | **BankMatchingService finds exact header signature match (100%)**     | **TECH-001 mitigation: precise matching**       |
| 2.4-UNIT-028  | Unit        | **P0**   | **BankMatchingService calculates confidence score for partial match** | **TECH-001 mitigation: confidence indicator**   |
| 2.4-UNIT-029  | Unit        | **P0**   | **Multiple matches sorted by confidence score descending**            | **TECH-001 mitigation: prioritization**         |
| 2.4-INT-015   | Integration | **P0**   | **PreviewCsvHandler loads saved mapping when exact match found**      | **TECH-001 mitigation: auto-apply logic**       |
| 2.4-INT-016   | Integration | **P0**   | **Multiple matches trigger disambiguation (no auto-apply)**           | **TECH-001 mitigation: prevent silent errors**  |
| 2.4-E2E-008   | E2E         | **P0**   | **User sees disambiguation dialog when multiple mappings match**      | **TECH-001 mitigation: user choice required**   |

**Coverage:** 6 tests (**All P0** - critical risk mitigation)

---

### Performance Testing (PERF-001 - High Risk Score 6)

**Risk:** Drag-drop performance degradation with large CSVs (>50 columns)

| Test ID       | Level       | Priority | Test Description                                          | Justification                                    |
|---------------|-------------|----------|-----------------------------------------------------------|--------------------------------------------------|
| 2.4-PERF-001  | Performance | P1       | Drag-drop latency < 100ms with 100-column CSV             | PERF-001 mitigation: validate responsiveness     |
| 2.4-PERF-002  | Performance | P1       | Preview table update latency < 200ms after drop           | PERF-001 mitigation: user experience validation  |

**Coverage:** 2 performance tests (both P1)

---

### Security Testing (SEC-001 - High Risk Score 6)

**Risk:** CSV injection via bank identifier field

| Test ID       | Level       | Priority | Test Description                                                  | Justification                                  |
|---------------|-------------|----------|-------------------------------------------------------------------|------------------------------------------------|
| 2.4-SEC-001   | Security    | **P0**   | **XSS payload in bank identifier rejected by server validation**  | **SEC-001 mitigation: injection prevention**   |
| 2.4-SEC-002   | Security    | **P0**   | **CSV formula injection (=cmd) sanitized in bank identifier**     | **SEC-001 mitigation: CSV injection**          |
| 2.4-SEC-003   | Security    | **P0**   | **Bank identifier displayed without HTML rendering (XSS safe)**   | **SEC-001 mitigation: output encoding**        |

**Coverage:** 3 security tests (**All P0** - high security risk)

---

## Test Scenarios Summary Table (All 47 Tests)

### By Test Level

| Level       | P0  | P1  | P2  | P3  | Total |
|-------------|-----|-----|-----|-----|-------|
| Unit        | 11  | 11  | 4   | 0   | **26** |
| Integration | 7   | 5   | 2   | 0   | **14** |
| E2E         | 3   | 4   | 0   | 0   | **7**  |
| Performance | 0   | 2   | 0   | 0   | **2**  |
| Security    | 3   | 0   | 0   | 0   | **3**  |
| **Total**   | **24** | **22** | **6** | **0** | **47** |

### By Acceptance Criteria

| AC  | Description                          | Tests | P0  | P1  | P2  |
|-----|--------------------------------------|-------|-----|-----|-----|
| AC1 | Drag-drop UI with CSV headers        | 5     | 0   | 4   | 1   |
| AC2 | Drop zones for field types           | 6     | 0   | 4   | 2   |
| AC3 | Preview table with highlighting      | 6     | 0   | 4   | 2   |
| AC4 | Validation for required columns      | 12    | **9** | 2   | 1   |
| AC5 | Save mapping functionality           | 12    | **6** | 4   | 2   |
| AC6 | Settings â†’ Import Rules page         | 6     | 0   | 4   | 2   |
| **Risk Mitigations** | Bank disambiguation, perf, security | **11** | **9** | **2** | **0** |
| **Total**            |                                      | **47** | **24** | **22** | **6** |

---

## Risk Coverage Matrix

### Critical Risks (Score 9)

| Risk ID   | Risk Description                           | Test Coverage                            | P0 Tests |
|-----------|--------------------------------------------|------------------------------------------|----------|
| DATA-001  | Incorrect column mapping â†’ corrupted data  | 2.4-UNIT-014 to 017, INT-005/006, E2E-004 | **9**    |
| TECH-001  | Bank pattern matching ambiguity            | 2.4-UNIT-027 to 029, INT-015/016, E2E-008 | **6**    |

**Total P0 tests for critical risks:** **15 tests**

### High Risks (Score 6)

| Risk ID   | Risk Description                               | Test Coverage                         | Tests |
|-----------|------------------------------------------------|---------------------------------------|-------|
| PERF-001  | Drag-drop performance with large CSVs          | 2.4-PERF-001/002                      | 2 P1  |
| SEC-001   | CSV injection via bank identifier              | 2.4-SEC-001/002/003                   | 3 P0  |
| DATA-002  | Saved mapping invalid after format change      | 2.4-INT-010 (timestamps for staleness)| 1 P1  |
| OPS-001   | Missing database migration                     | (Manual verification - not automated) | N/A   |

**Total tests for high risks:** **6 tests**

### Medium Risks (Score 4)

| Risk ID   | Risk Description                     | Test Coverage                    | Tests |
|-----------|--------------------------------------|----------------------------------|-------|
| TECH-002  | Drag-drop state management           | 2.4-INT-001/002/003              | 3 P1  |
| DATA-003  | Unbounded saved mappings growth      | 2.4-INT-011 (50 mapping limit)   | 1 P2  |
| BUS-001   | User confusion with UI               | 2.4-E2E-001/002/003 (usability)  | 3 P1  |
| OPS-002   | Settings page not linked             | 2.4-E2E-006 (navigation)         | 1 P1  |

**Total tests for medium risks:** **8 tests**

---

## Recommended Test Execution Order

### Phase 1: Fail Fast (P0 Critical - 24 tests)

**Estimated Time:** 2-3 minutes (unit tests run in parallel)

**Execution Order:**
1. **P0 Unit Tests** (11 tests) - Validation logic, sanitization, business rules
   - DATA-001 validation tests (2.4-UNIT-014 to 017) - **4 tests**
   - TECH-001 bank matching tests (2.4-UNIT-027 to 029) - **3 tests**
   - SEC-001 sanitization tests (included in 2.4-UNIT-020 to 022) - **3 tests**
   - Required field validation (2.4-UNIT-011 to 013) - **3 tests**

2. **P0 Integration Tests** (7 tests) - Database operations, API contracts
   - Mapping persistence (2.4-INT-007/008) - **2 tests**
   - Server-side validation (2.4-INT-005/006) - **2 tests**
   - Bank matching integration (2.4-INT-015/016) - **2 tests**

3. **P0 E2E Tests** (3 tests) - Critical user workflows
   - Invalid mapping workflow (2.4-E2E-004)
   - Save mapping workflow (2.4-E2E-005)
   - Bank disambiguation workflow (2.4-E2E-008)

4. **P0 Security Tests** (3 tests) - Security vulnerability validation
   - XSS injection (2.4-SEC-001)
   - CSV formula injection (2.4-SEC-002)
   - Output encoding (2.4-SEC-003)

**Failure Action:** If any P0 test fails, **STOP** and fix before proceeding.

---

### Phase 2: Core Functionality (P1 - 22 tests)

**Estimated Time:** 3-4 minutes

**Execution Order:**
1. **P1 Unit Tests** (11 tests) - Component logic, rendering, UX feedback
2. **P1 Integration Tests** (5 tests) - Component interactions, API workflows
3. **P1 E2E Tests** (4 tests) - Main user journeys
4. **P1 Performance Tests** (2 tests) - Drag-drop responsiveness

**Failure Action:** Fix before production deployment (blocking for release).

---

### Phase 3: Secondary Features (P2 - 6 tests)

**Estimated Time:** 1-2 minutes

**Execution Order:**
1. P2 Unit Tests (4 tests) - Edge cases, optional features
2. P2 Integration Tests (2 tests) - Secondary workflows

**Failure Action:** Can deploy with known issues documented (non-blocking).

---

## Test Data Requirements

### CSV Test Samples

**Source:** `tests/TestData/CsvSamples/`

**Required Samples:**

1. **Standard CSVs** (4 samples) - For happy path testing
   - `chase_checking.csv` - Standard bank format
   - `bofa_savings.csv` - Different column order
   - `wells_fargo.csv` - Extra columns (memo, balance)
   - `credit_union.csv` - Minimal columns (date, amount, description)

2. **Edge Case CSVs** (4 samples) - For validation and error testing
   - `large_columns.csv` - 100 columns (PERF-001 testing)
   - `invalid_date_column.csv` - Date column contains text (DATA-001 testing)
   - `invalid_amount_column.csv` - Amount column contains text (DATA-001 testing)
   - `duplicate_headers.csv` - Duplicate column names (ambiguity testing)

3. **Security Test Samples** (2 samples) - For SEC-001 testing
   - `xss_headers.csv` - Headers containing `<script>` tags
   - `csv_injection.csv` - Headers containing `=cmd` formulas

**Total Test Samples:** 10 CSV files

---

### Test Database Fixtures

**Saved Mappings:**

1. **chase_checking_mapping** - Exact header signature for `chase_checking.csv`
2. **chase_savings_mapping** - Similar header signature (70% match with checking)
3. **bofa_savings_mapping** - Different bank, no conflicts
4. **stale_mapping** - LastUsedAt > 90 days ago (DATA-002 testing)
5. **limit_test_mappings** - 49 mappings for single user (DATA-003 testing)

**Total Fixtures:** 5 saved mapping records

---

## Test Environment Requirements

### Unit Tests (Jest 29.7.0)

- **Runtime:** Node.js 20.11.0 LTS
- **Mocking:** Jest mocks for Angular services
- **Execution:** Parallel execution enabled
- **Coverage Target:** >80% for new code

**Dependencies:**
- Angular Material mocks for drag-drop testing
- Signal mocks for reactive state testing

---

### Integration Tests (xUnit 2.7.0)

- **Database:** In-memory SQLite for isolated tests
- **Mocking:** NSubstitute 5.1.0 for external dependencies
- **Execution:** Sequential (database state management)
- **Coverage Target:** >70% for service layer

**Dependencies:**
- Entity Framework Core in-memory provider
- FluentValidation test harness

---

### E2E Tests (Playwright 1.42.1)

- **Browser:** Chromium headless
- **Test Data:** Fresh database with fixtures loaded before each test
- **Execution:** Sequential (UI interactions)
- **Coverage Target:** All P0 and P1 user journeys

**Dependencies:**
- Playwright test fixtures for authentication
- Test data seeding scripts

---

### Performance Tests (Custom Benchmarking)

- **Tool:** Chrome DevTools Performance API
- **Metrics:** Drag latency (P50, P95), Preview update time
- **Hardware:** Standard desktop (Intel i5, 8GB RAM)
- **Threshold:** P95 < 100ms for drag-drop, < 200ms for preview update

---

### Security Tests (OWASP ZAP + Manual)

- **Tool:** OWASP ZAP for automated scanning
- **Manual Testing:** XSS and CSV injection payloads
- **Coverage:** All input fields (bank identifier, column mappings)

---

## Coverage Gaps

### Identified Gaps (None - All ACs Covered)

âœ… **AC1:** Covered by 5 tests (UNIT-001 to 003, INT-001, E2E-001)
âœ… **AC2:** Covered by 6 tests (UNIT-004 to 006, INT-002/003, E2E-002)
âœ… **AC3:** Covered by 6 tests (UNIT-007 to 010, INT-004, E2E-003)
âœ… **AC4:** Covered by 12 tests (UNIT-011 to 019, INT-005/006, E2E-004)
âœ… **AC5:** Covered by 12 tests (UNIT-020 to 025, INT-007 to 011, E2E-005)
âœ… **AC6:** Covered by 6 tests (UNIT-026, INT-012 to 014, E2E-006/007)

**Additional Coverage:**
- Critical risks (DATA-001, TECH-001) have dedicated test suites (15 P0 tests)
- High risks (PERF-001, SEC-001) have targeted test coverage (5 tests)
- Medium risks covered by existing AC tests

---

## Test Maintenance Considerations

### High Maintenance Risk

**E2E Tests (7 tests):**
- Brittle due to UI changes (Angular Material component updates)
- Drag-drop interactions sensitive to timing issues
- **Mitigation:** Use Playwright auto-wait, stable selectors (data-testid attributes)

**Integration Tests with Database (14 tests):**
- Schema changes break tests (ColumnMappingRule entity evolution)
- **Mitigation:** Use database migration tests, keep fixtures in sync

### Low Maintenance Risk

**Unit Tests (26 tests):**
- Isolated from UI and database changes
- Pure logic tests stable across refactoring
- **Best Practice:** Keep unit tests focused on single responsibility

---

## Test Automation Strategy

### CI/CD Pipeline Integration

**GitHub Actions Workflow:**

1. **On Pull Request:**
   - Run P0 unit tests (fail fast)
   - Run P0 integration tests
   - Run P0 E2E tests
   - Run security tests
   - **Gate:** All P0 tests must pass before merge

2. **On Merge to Main:**
   - Run full test suite (P0 + P1 + P2)
   - Run performance tests
   - Generate coverage report
   - **Gate:** >80% coverage required

3. **Nightly Build:**
   - Run full regression suite
   - Run manual security tests
   - Update test data samples

### Test Execution Time

**Target:** <10 minutes for full suite

- **Unit tests (26):** ~2 minutes (parallel execution)
- **Integration tests (14):** ~3 minutes (sequential)
- **E2E tests (7):** ~4 minutes (sequential with browser startup)
- **Performance tests (2):** ~1 minute (benchmarking)
- **Security tests (3):** ~2 minutes (payload scanning)

**Total:** ~12 minutes (acceptable for pre-merge validation)

**Optimization Opportunities:**
- Parallelize integration tests with isolated databases
- Use Playwright sharding for E2E tests (split across multiple workers)

---

## Quality Checklist

Before finalizing test implementation, verify:

- [x] Every AC has test coverage (All 6 ACs covered)
- [x] Test levels are appropriate (Unit-heavy approach, targeted integration/E2E)
- [x] No duplicate coverage across levels (Distinct responsibilities per level)
- [x] Priorities align with business risk (24 P0 tests for critical risks)
- [x] Test IDs follow naming convention (2.4-{LEVEL}-{SEQ})
- [x] Scenarios are atomic and independent (Each test focuses on single behavior)
- [x] Risk mitigations addressed (15 P0 tests for DATA-001 and TECH-001)
- [x] Performance considerations included (2 performance tests for PERF-001)
- [x] Security vulnerabilities tested (3 security tests for SEC-001)

---

## Recommendations

### Immediate Actions

1. **Create Test Data Samples** (Priority: High)
   - Generate 10 CSV samples in `tests/TestData/CsvSamples/`
   - Include edge cases (large columns, invalid data types, security payloads)
   - Document sample characteristics in README

2. **Implement P0 Tests First** (Priority: Critical)
   - Start with DATA-001 validation tests (2.4-UNIT-014 to 017)
   - Follow with TECH-001 bank matching tests (2.4-UNIT-027 to 029)
   - Implement SEC-001 security tests (2.4-SEC-001 to 003)

3. **Set Up Test Fixtures** (Priority: High)
   - Create 5 saved mapping fixtures for integration tests
   - Seed test database with fixtures before each test run
   - Document fixture data in `tests/fixtures/README.md`

### Future Improvements

1. **Visual Regression Testing**
   - Add Playwright screenshot comparison for drag-drop UI
   - Validate preview table highlighting consistency
   - **Timeline:** Phase 2 (post-MVP)

2. **Test Data Generation**
   - Use Bogus 35.5.0 to generate realistic CSV data
   - Automate test sample creation for edge cases
   - **Timeline:** Phase 2 (when test suite grows)

3. **Performance Monitoring**
   - Integrate performance tests into CI/CD pipeline
   - Track P95 latency trends over time
   - Alert on performance regressions (>20% increase)
   - **Timeline:** After initial deployment (first 30 days)

---

## Summary

This test design provides **comprehensive coverage** for Story 2.4 with **47 test scenarios** across all levels, prioritizing **24 P0 critical tests** for high-risk areas (data integrity, bank matching, security).

**Key Strengths:**
- âœ… Risk-based approach with 15 P0 tests for critical risks (DATA-001, TECH-001)
- âœ… Balanced test pyramid (55% unit, 30% integration, 15% E2E)
- âœ… Clear execution order (fail fast with P0 tests)
- âœ… Comprehensive risk coverage (all 18 identified risks addressed)

**Test Implementation Effort:**
- **Unit tests:** ~6 hours (26 tests)
- **Integration tests:** ~5 hours (14 tests)
- **E2E tests:** ~4 hours (7 tests)
- **Performance tests:** ~2 hours (2 tests)
- **Security tests:** ~2 hours (3 tests)
- **Total:** ~19 hours (approximately 2.5 development days)

**Next Steps:**
1. Review test design with development team
2. Create test data samples and fixtures
3. Implement P0 tests first (DATA-001, TECH-001, SEC-001)
4. Run tests incrementally as features are developed
5. Update risk profile based on test results

---

**Test Design References:**
- Risk Profile: [docs/qa/assessments/2.4-risk-20251016.md](2.4-risk-20251016.md)
- Story File: [docs/stories/2.4.manual-column-mapping.md](../../stories/2.4.manual-column-mapping.md)
- Test Levels Framework: [.bmad-core/data/test-levels-framework.md](../../../.bmad-core/data/test-levels-framework.md)
- Test Priorities Matrix: [.bmad-core/data/test-priorities-matrix.md](../../../.bmad-core/data/test-priorities-matrix.md)

---

*Test design created by Quinn (Test Architect) on 2025-10-16*
*Review and update as implementation progresses*
