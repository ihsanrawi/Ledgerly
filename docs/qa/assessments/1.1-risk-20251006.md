# Risk Profile: Story 1.1 - VSA Project Structure

**Date:** 2025-10-06
**Reviewer:** Quinn (Test Architect)
**Story:** 1.1 - Set Up VSA Project Structure with Wolverine

---

## Executive Summary

- **Total Risks Identified:** 9
- **Critical Risks:** 1 (TECH-001)
- **High Risks:** 2 (TECH-002, OPS-002)
- **Medium Risks:** 3 (TECH-003, SEC-001, OPS-001)
- **Low Risks:** 3 (TECH-004, DATA-001, BUS-001)
- **Risk Score:** 63/100 (Moderate Risk)

**Risk Score Calculation:**
- Base: 100
- Critical (1 × 20): -20
- High (2 × 10): -20
- Medium (3 × 5): -15
- Low (3 × 2): -6
- **Total Deductions:** -37
- **Final Score:** 63/100

---

## Critical Risks Requiring Immediate Attention

### TECH-001: Tauri Process Spawning Failure

**Score: 9 (Critical)**

**Probability:** High (3) - Tauri integration incomplete, requires Rust installation not present in dev environment, cross-platform process spawning unproven.

**Impact:** High (3) - Complete blockage of hledger integration which is the core foundation of the entire application. All double-entry accounting functionality depends on successful process execution.

**Affected Components:**
- `Ledgerly.Desktop` (Tauri wrapper)
- `HledgerProcessRunner` (planned for Story 1.2)
- All hledger-dependent features (import, balance queries, reports)

**Current Status:**
- Dev notes show Tauri tasks incomplete due to missing Rust installation
- Runtime validation deferred
- No validation of process spawning capabilities

**Mitigation:**

1. **Immediate Actions:**
   - Install Rust toolchain on development machine
   - Complete Tauri configuration (`tauri.conf.json`)
   - Test basic process spawning with simple shell commands (e.g., `echo`, `ls`)
   - Validate native file I/O permissions on local platform first

2. **Week 1 Validation Gate (Story 1.2):**
   - Execute `hledger --version` successfully on all platforms
   - Test file system access for reading `.hledger` files
   - Validate cross-platform builds (Windows .exe, macOS .dmg, Linux .AppImage)
   - Decision point: Proceed with Tauri OR pivot to Electron 29.1.0 fallback

3. **Fallback Strategy:**
   - Electron 29.1.0 already documented as backup option
   - Larger bundle size (50-100MB vs 10-15MB) acceptable if Tauri fails
   - Migration effort estimated at 1-2 days if pivot required

**Testing Focus:**

- **Priority 1:** Process spawning tests with dummy commands
- **Priority 2:** Native file system read/write tests
- **Priority 3:** Cross-platform compilation tests
- **Priority 4:** hledger binary execution tests (Story 1.2)

**Residual Risk:** Medium - Even with validation, edge cases in process spawning may emerge in production across different OS configurations.

---

## High-Priority Risks

### TECH-002: .NET Runtime Version Mismatch

**Score: 6 (High)**

**Probability:** High (3) - Dev notes confirm .NET 9 installed but project requires .NET 8.0.4 LTS.

**Impact:** Medium (2) - Runtime validation incomplete, potential CI/CD failures, deployment issues on target machines.

**Affected Components:**
- `Ledgerly.Api` (.NET 8 Web API)
- CI/CD pipeline (GitHub Actions)
- Deployment packages and installers

**Mitigation:**

1. Install .NET 8.0.4 SDK explicitly (`dotnet --list-sdks` to verify)
2. Update `global.json` to pin SDK version to 8.0.4
3. Configure GitHub Actions to use .NET 8 runtime (not default latest)
4. Add runtime version check to `scripts/bootstrap.sh`
5. Document required runtime in README prerequisites section

**Testing Requirements:**
- Verify `dotnet build` succeeds with .NET 8 SDK
- Test CI/CD pipeline with .NET 8 matrix
- Validate deployment packages on clean VM without .NET 9

**Residual Risk:** Low - Once correct SDK installed and CI configured, risk largely mitigated.

---

### OPS-002: Incomplete End-to-End Validation

**Score: 6 (High)**

**Probability:** High (3) - Dev notes explicitly state E2E validation deferred, multiple integration points unvalidated.

**Impact:** Medium (2) - Unknown bugs may exist in production, but incremental validation mitigates severity.

**Affected Components:**
- Full stack integration (Angular ↔ .NET API)
- Swagger UI at `/swagger`
- Health check endpoint (`/api/health`)
- Tauri app launch

**Mitigation:**

1. **Immediate Validation Checklist:**
   - [ ] Install .NET 8 runtime
   - [ ] Run `dotnet run` in `src/Ledgerly.Api/`
   - [ ] Navigate to `http://localhost:5000/swagger` - verify Swagger UI loads
   - [ ] Call `/api/health` endpoint - expect 200 OK response
   - [ ] Run `npm run build` in `src/Ledgerly.Web/` - verify no errors
   - [ ] Install Rust, configure Tauri, test app launch

2. **Story 1.3 Integration:**
   - Create Angular component that calls health check endpoint
   - Validate HTTP communication between frontend and backend
   - Add smoke tests to CI/CD pipeline

3. **Documentation:**
   - Document manual validation steps in Story 1.1 completion notes
   - Create "Smoke Test Checklist" for future stories

**Testing Requirements:**
- Manual smoke test execution
- Automated health check endpoint test
- CI/CD pipeline validation

**Residual Risk:** Low - Incremental validation in Story 1.3 will catch integration issues.

---

## Medium-Priority Risks

### TECH-003: Wolverine HTTP Endpoint Discovery

**Score: 4 (Medium)**

**Probability:** Medium (2) - WolverineFx.Http v3.0.0 is stable, but auto-discovery adds complexity.

**Impact:** Medium (2) - VSA feature slice pattern relies on this; manual registration available as fallback.

**Mitigation:**
- Validate health check endpoint appears in Swagger UI (confirms discovery works)
- Document manual endpoint registration pattern for fallback
- Monitor Wolverine GitHub releases for breaking changes

**Testing:** Integration tests for endpoint auto-discovery, OpenAPI spec validation.

---

### SEC-001: Swagger UI Exposed in Production

**Score: 4 (Medium)**

**Probability:** Medium (2) - Default configuration exposes `/swagger` without authentication.

**Impact:** Medium (2) - API structure exposed, but limited attack surface (desktop app, not public web).

**Mitigation:**
- Disable Swagger in production builds (`#if DEBUG` or environment check)
- Add authentication middleware if Swagger needed in production
- Document security considerations in deployment guide

**Testing:** Verify Swagger disabled in release builds, security scan for exposed endpoints.

---

### OPS-001: Cross-Platform Build Failures

**Score: 4 (Medium)**

**Probability:** Medium (2) - CI/CD workflow stub created, but builds unvalidated across platforms.

**Impact:** Medium (2) - Delays deployment, but doesn't block local development.

**Mitigation:**
- Configure GitHub Actions matrix builds (Windows, macOS, Linux)
- Use GitHub-hosted runners for consistency
- Add build status badges to README

**Testing:** Validate builds on all target platforms, test artifact generation.

---

## Low-Priority Risks

### TECH-004: Angular Signals Migration Complexity

**Score: 2 (Low)**
Angular 17 Signals are stable; follow best practices, use computed() for derived state.

---

### DATA-001: SQLite Cache Corruption

**Score: 3 (Low)**
EF Core 8.0.4 stable, cache-only design limits impact. Implement cache rebuilding from `.hledger` files.

---

### BUS-001: Dependency Version Lock-In

**Score: 2 (Low)**
LTS versions chosen (.NET 8, Node 20). Plan quarterly dependency review, monitor security advisories.

---

## Risk Distribution

### By Category

| Category | Total | Critical | High | Medium | Low |
|----------|-------|----------|------|--------|-----|
| Technical (TECH) | 4 | 1 | 1 | 1 | 1 |
| Security (SEC) | 1 | 0 | 0 | 1 | 0 |
| Data (DATA) | 1 | 0 | 0 | 0 | 1 |
| Operational (OPS) | 2 | 0 | 1 | 1 | 0 |
| Business (BUS) | 1 | 0 | 0 | 0 | 1 |

### By Component

| Component | Risk Count | Highest Risk |
|-----------|------------|--------------|
| Ledgerly.Desktop (Tauri) | 3 | TECH-001 (Critical) |
| Ledgerly.Api (.NET) | 2 | TECH-002 (High) |
| CI/CD Pipeline | 2 | OPS-001 (Medium) |
| Full Stack Integration | 1 | OPS-002 (High) |
| Wolverine HTTP | 1 | TECH-003 (Medium) |
| Angular Signals | 1 | TECH-004 (Low) |
| SQLite | 1 | DATA-001 (Low) |
| Dependencies | 1 | BUS-001 (Low) |

---

## Detailed Risk Register

| Risk ID | Category | Description | Probability | Impact | Score | Priority | Mitigation Owner |
|---------|----------|-------------|-------------|--------|-------|----------|------------------|
| TECH-001 | Technical | Tauri process spawning failure | High (3) | High (3) | 9 | Critical | Dev |
| TECH-002 | Technical | .NET runtime version mismatch | High (3) | Medium (2) | 6 | High | Dev |
| OPS-002 | Operational | Incomplete E2E validation | High (3) | Medium (2) | 6 | High | Dev |
| TECH-003 | Technical | Wolverine HTTP endpoint discovery | Medium (2) | Medium (2) | 4 | Medium | Dev |
| SEC-001 | Security | Swagger UI exposed in production | Medium (2) | Medium (2) | 4 | Medium | Dev |
| OPS-001 | Operational | Cross-platform build failures | Medium (2) | Medium (2) | 4 | Medium | DevOps |
| DATA-001 | Data | SQLite cache corruption | Low (1) | High (3) | 3 | Low | Dev |
| TECH-004 | Technical | Angular Signals migration complexity | Low (1) | Medium (2) | 2 | Low | Dev |
| BUS-001 | Business | Dependency version lock-in | Low (1) | Medium (2) | 2 | Low | Dev |

---

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests (TECH-001)

**Test Scenarios:**
1. **Process Spawning Validation:**
   - Test: Execute simple shell command (`echo "test"`) via Tauri IPC
   - Expected: Output captured successfully, exit code 0
   - Platforms: Windows, macOS, Linux

2. **File I/O Permissions:**
   - Test: Read sample `.hledger` file from user-selected directory
   - Expected: File contents retrieved without permission errors
   - Platforms: All

3. **Cross-Platform Builds:**
   - Test: Build Tauri app for all target platforms
   - Expected: Executable/installer generated without errors
   - Artifacts: `.exe` (Windows), `.dmg` (macOS), `.AppImage` (Linux)

**Required Test Types:**
- Integration tests (Tauri IPC ↔ backend)
- Manual smoke tests on all platforms
- Automated build validation in CI

**Test Data Requirements:**
- Sample shell commands (echo, ls, cat)
- Sample `.hledger` file (5-10 transactions)
- Clean VM environments for build testing

---

### Priority 2: High Risk Tests (TECH-002, OPS-002)

**Test Scenarios:**
1. **Runtime Version Validation:**
   - Test: `dotnet --version` in CI pipeline
   - Expected: Output matches `8.0.4xx`

2. **Health Check Endpoint:**
   - Test: HTTP GET to `/api/health`
   - Expected: 200 OK, JSON response

3. **Swagger UI Loading:**
   - Test: Navigate to `/swagger` in browser
   - Expected: Swagger UI displays with health endpoint visible

**Required Test Types:**
- CI/CD pipeline tests
- API integration tests
- Manual browser validation

---

### Priority 3: Medium/Low Risk Tests

**Standard Functional Tests:**
- Wolverine HTTP endpoint discovery validation
- Swagger disabled in production builds
- SQLite cache initialization
- Angular Signals reactivity tests
- Dependency version checks

**Regression Test Suite:**
- Backend builds successfully
- Frontend builds successfully
- ESLint/Prettier formatting checks
- Unit test coverage >70%

---

## Risk Acceptance Criteria

### Must Fix Before Production

**Critical Risks (Score 9):**
- ✅ **TECH-001:** Tauri process spawning MUST work OR pivot to Electron fallback
  - **Gate:** Week 1 validation in Story 1.2
  - **Sign-off Required:** Technical Lead

**High Risks (Score 6) - Security/Data Impact:**
- ✅ **TECH-002:** .NET 8 runtime installed and validated
- ✅ **OPS-002:** E2E smoke tests passing (Angular ↔ API ↔ Swagger)

---

### Can Deploy with Mitigation

**Medium Risks with Compensating Controls:**
- ⚠️ **SEC-001:** Swagger UI - Disable in production builds
- ⚠️ **TECH-003:** Wolverine HTTP - Manual registration documented as fallback
- ⚠️ **OPS-001:** Cross-platform builds - Validate in CI before release

---

### Accepted Risks

**Low Risks (Score ≤3):**
- 📝 **DATA-001:** SQLite corruption - Accepted with cache rebuild functionality
- 📝 **TECH-004:** Angular Signals - Accepted, framework mature and stable
- 📝 **BUS-001:** Dependency lock-in - Accepted, quarterly review planned

**Sign-off:** Solo developer project, technical lead accepts residual low-priority risks.

---

## Monitoring Requirements

### Post-Deployment Monitoring

**For Tauri Process Spawning (TECH-001):**
- Application crash logs (process spawning failures)
- Platform-specific error rates (Windows vs macOS vs Linux)
- hledger execution success rate metrics

**For .NET Runtime (TECH-002):**
- Application startup errors on user machines
- Runtime version mismatches in error logs

**For E2E Integration (OPS-002):**
- API endpoint error rates (health check, future endpoints)
- Frontend HTTP request failures
- CORS errors in browser console

**For Security (SEC-001):**
- Unauthorized access attempts to `/swagger` endpoint (if exposed)
- API structure enumeration attempts

---

## Risk Review Triggers

Review and update this risk profile when:

1. **Architecture Changes:**
   - Tauri validation fails → Electron fallback activated
   - Wolverine HTTP discovery issues → Manual registration implemented

2. **New Integrations:**
   - hledger binary integration (Story 1.2) - adds process execution complexity
   - FileSystemWatcher integration - adds file I/O risks

3. **Security Vulnerabilities:**
   - CVEs announced for Wolverine, Tauri, .NET 8, Angular 17
   - Dependency security advisories (Dependabot alerts)

4. **Performance Issues:**
   - SQLite query performance degradation
   - Angular app load time regressions

5. **Regulatory/Compliance:**
   - Data privacy requirements (GDPR, CCPA) if cloud sync added (Phase 2)

---

## Recommendations Summary

### Must-Fix (Gate Blockers)

1. **Install Rust toolchain** → Complete Tauri configuration → Validate process spawning
2. **Install .NET 8.0.4 SDK** → Verify builds → Configure CI/CD
3. **Execute E2E smoke tests** → Health check + Swagger UI + Angular build

### Should-Fix (Pre-Production)

4. Disable Swagger UI in production builds
5. Validate cross-platform builds in CI matrix
6. Document Wolverine HTTP manual registration fallback

### Monitor (Accepted Risks)

7. SQLite cache corruption detection on startup
8. Quarterly dependency security review
9. Angular Signals best practices adherence

---

**Risk Profile Status:** ⚠️ **MODERATE RISK (63/100)**

**Gate Recommendation:** CONCERNS (Critical risk TECH-001 requires Week 1 validation before final approval)

**Next Review:** After Story 1.2 completion (hledger integration + Tauri validation)

---

*Generated by Quinn (QA Test Architect) on 2025-10-06*
