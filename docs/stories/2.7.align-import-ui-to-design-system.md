# Story 2.7: Align Import Preview UI to Design System

## Status
Approved

## Epic

**Epic 2: CSV Import & Smart Data Entry**

[Source: docs/prd/epic-details.md#L153-L166]

**Epic Goal:** Enable users to import bank CSV files with intelligent column detection, manual mapping fallback, duplicate detection, and category suggestion rules.

## Story

**As a** user,
**I want** the CSV import preview interface to follow Ledgerly's design system standards,
**so that** I experience a consistent, professional, and polished UI across the application.

## Acceptance Criteria

1. Import preview table follows design system table pattern (bordered container, hover states, proper padding)
2. Typography matches design system scale: Page title (1.875rem bold), amounts (monospace 1.125rem), body text (1rem)
3. Colors use CSS custom properties from design system (--accent-color, --success-color, --destructive-color, --text-secondary)
4. Spacing follows design system scale: Section gaps (1.5rem), component gaps (1rem), card padding (1.5rem)
5. Success/error snackbars match design system alert/banner patterns (colored backgrounds with 10% opacity)
6. Responsive layout follows design system breakpoints (mobile-first, desktop changes at 1024px)
7. Monospace fonts applied to monetary amounts, dates, and transaction data
8. Visual design verified via side-by-side comparison with design samples (docs/design-samples/)

## Tasks / Subtasks

- [ ] Pre-Implementation: Review design system and identify patterns (AC: 1-8)
  - [ ] Read design-system.md Sections: Typography, Color System, Spacing & Layout, Component Patterns (Tables, Buttons, Badges)
  - [ ] Review design samples: CSV Import page (docs/design-samples/src/pages/CsvImport.tsx) for visual reference
  - [ ] Identify specific gaps in current import-csv component styling
  - [ ] Create checklist of design system patterns to apply

- [ ] Frontend: Update table styling to match design system table pattern (AC: 1)
  - [ ] Wrap table in rounded border container: `border: 1px solid var(--border-color); border-radius: 0.5rem; overflow: hidden;`
  - [ ] Update table header background: `background: var(--muted-bg)` with 50% opacity
  - [ ] Add row hover states: `hover:bg-muted/30 transition-colors` (translate to SCSS: `background: rgba(var(--muted-bg-rgb), 0.3); transition: background-color 0.2s;`)
  - [ ] Update table cell padding to `1rem` (16px) for consistency
  - [ ] Add row dividers: `border-bottom: 1px solid var(--border-color)`
  - [ ] Ensure duplicate rows are visually distinct (grayed out, lower opacity)

- [ ] Frontend: Apply design system typography patterns (AC: 2, 7)
  - [ ] Update page title styling: `font-size: 1.875rem; font-weight: 700; color: var(--text-primary);`
  - [ ] Update section subtitles: `font-size: 1rem; color: var(--text-secondary); margin-top: 0.25rem;`
  - [ ] Apply monospace font to amount columns: `font-family: 'Courier New', monospace; font-size: 1.125rem; font-weight: 600;`
  - [ ] Apply monospace font to date columns: `font-family: 'Courier New', monospace; font-size: 0.875rem;`
  - [ ] Update table header text: `font-size: 0.875rem; font-weight: 500;`
  - [ ] Ensure body text uses standard font: `font-size: 1rem; font-weight: 400;`

- [ ] Frontend: Implement design system color palette (AC: 3)
  - [ ] Define CSS custom properties in component stylesheet (if not globally available):
    - `--accent-color: hsl(168, 76%, 42%);` (Teal for primary actions)
    - `--success-color: hsl(145, 63%, 42%);` (Green for positive states)
    - `--destructive-color: hsl(0, 65%, 51%);` (Red for warnings/errors)
    - `--text-primary: hsl(210, 11%, 15%);` (Dark text)
    - `--text-secondary: hsl(215, 14%, 34%);` (Muted text)
    - `--border-color: hsl(210, 20%, 90%);` (Borders)
    - `--muted-bg: hsl(210, 17%, 95%);` (Muted backgrounds)
  - [ ] Update "Import" button to use accent color: `background: var(--accent-color); color: white;`
  - [ ] Update category badges: Use colored backgrounds with 10% opacity (e.g., `background: rgba(var(--success-color-rgb), 0.1); color: var(--success-color);`)
  - [ ] Update duplicate status chips: Red for duplicates (`var(--destructive-color)`), green for new (`var(--success-color)`)
  - [ ] Replace any hardcoded color values (#1ABC9C, #22C55E, etc.) with CSS custom properties

- [ ] Frontend: Apply design system spacing scale (AC: 4)
  - [ ] Update section spacing: `margin-bottom: 1.5rem;` between major sections (page header, summary card, preview table)
  - [ ] Update component spacing: `margin-bottom: 1rem;` between related components (within summary card)
  - [ ] Update card padding: `padding: 1.5rem;` for summary card and table container
  - [ ] Update form field spacing: `margin-bottom: 0.75rem;` (12px) for form fields within table cells
  - [ ] Ensure consistent gap between buttons: `gap: 0.5rem;` (8px)
  - [ ] Add breathing room to page container: `padding: 1.5rem;`

- [ ] Frontend: Update success/error snackbar styling (AC: 5)
  - [ ] Update success snackbar background: `background: rgba(var(--success-color-rgb), 0.1); border: 1px solid rgba(var(--success-color-rgb), 0.2); color: var(--success-color-dark);`
  - [ ] Update error snackbar background: `background: rgba(var(--destructive-color-rgb), 0.1); border: 1px solid rgba(var(--destructive-color-rgb), 0.2); color: var(--destructive-color-dark);`
  - [ ] Add icon to snackbars: Success uses checkmark icon, Error uses alert circle icon
  - [ ] Ensure snackbar text is readable (sufficient contrast with colored background)
  - [ ] Update snackbar border radius: `border-radius: 0.5rem;` (8px)
  - [ ] Add padding: `padding: 1rem;` for comfortable spacing

- [ ] Frontend: Implement responsive design patterns (AC: 6)
  - [ ] Ensure table is horizontally scrollable on mobile (wrap in `overflow-x: auto` container)
  - [ ] Update import summary card layout: Stack statistics vertically on mobile, horizontal on desktop (use flexbox with `flex-direction: column` on mobile, `row` on desktop at 1024px breakpoint)
  - [ ] Ensure buttons stack on mobile: `flex-direction: column; width: 100%;` below 768px, `flex-direction: row` above
  - [ ] Add mobile-specific padding: Reduce page padding to `1rem` on mobile (below 768px)
  - [ ] Test responsive behavior at breakpoints: 375px (mobile), 768px (tablet), 1024px (desktop)

- [ ] Frontend: Visual QA and comparison with design samples (AC: 8)
  - [ ] Open design sample: `docs/design-samples/src/pages/CsvImport.tsx` or rendered sample page
  - [ ] Side-by-side comparison: Current implementation vs. design sample
  - [ ] Verify table styling matches (borders, hover states, padding)
  - [ ] Verify typography matches (font sizes, weights, monospace for amounts)
  - [ ] Verify color usage matches (accent teal, success green, destructive red)
  - [ ] Verify spacing matches (section gaps, component gaps, card padding)
  - [ ] Take screenshots for documentation (before/after comparison)
  - [ ] Document any intentional deviations from design samples (if any)

- [ ] Testing: Update component unit tests (if styling changes affect test assertions)
  - [ ] Update snapshot tests if component HTML/CSS structure changed
  - [ ] Verify accessibility: Color contrast meets WCAG AA (success/error text readable on colored backgrounds)
  - [ ] Verify responsive behavior: Test at mobile (375px), tablet (768px), desktop (1024px) viewports
  - [ ] No functional test changes required (styling only, behavior unchanged)

## Dev Notes

### Design System Reference

**MANDATORY:** This story implements visual refinement of Story 2.6 to align with [architecture/design-system.md](../architecture/design-system.md).

**Context:** Story 2.6 (Import Preview and Confirmation) was implemented with basic Angular Material styling before the design system was created. All functionality is correct, but visual design needs alignment with Ledgerly's design standards.

**Scope:** Frontend-only (SCSS refactoring, no TypeScript/backend changes)

### Design System Quick Reference

[Source: docs/architecture/design-system.md]

**Colors (CSS Custom Properties):**
```scss
// Define in component SCSS or use from global styles
--accent-color: hsl(168, 76%, 42%);        // Teal - primary actions
--success-color: hsl(145, 63%, 42%);       // Green - positive states
--destructive-color: hsl(0, 65%, 51%);     // Red - errors, warnings
--text-primary: hsl(210, 11%, 15%);        // Dark text
--text-secondary: hsl(215, 14%, 34%);      // Muted text
--border-color: hsl(210, 20%, 90%);        // Borders
--muted-bg: hsl(210, 17%, 95%);            // Muted backgrounds
```

**Typography Scale:**
- **Page Title:** `font-size: 1.875rem; font-weight: 700;` (30px, bold)
- **Section Heading:** `font-size: 1.25rem; font-weight: 600;` (20px, semibold)
- **Body Text:** `font-size: 1rem; font-weight: 400;` (16px, normal)
- **Small Text:** `font-size: 0.875rem; font-weight: 400;` (14px for table cells, labels)
- **Amounts:** `font-family: 'Courier New', monospace; font-size: 1.125rem; font-weight: 600;` (18px, semibold)
- **Dates:** `font-family: 'Courier New', monospace; font-size: 0.875rem;` (14px)

**Spacing Scale:**
- **Section gaps:** `1.5rem` (24px)
- **Component gaps:** `1rem` (16px)
- **Card padding:** `1.5rem` (24px)
- **Table cell padding:** `1rem` (16px)
- **Form field gaps:** `0.75rem` (12px)
- **Button gaps:** `0.5rem` (8px)

**Border Radius:**
- **Cards, tables, containers:** `border-radius: 0.5rem;` (8px)
- **Buttons:** `border-radius: 0.375rem;` (6px)
- **Badges:** `border-radius: 9999px;` (fully rounded pills)

### Component Patterns to Apply

[Source: docs/architecture/design-system.md - Section 6: Component Patterns]

**Table Pattern (Section 6.2):**
```scss
// Container
.table-container {
  border-radius: 0.5rem;
  border: 1px solid var(--border-color);
  overflow: hidden;
}

// Table structure
table {
  width: 100%;

  thead {
    background: rgba(var(--muted-bg-rgb), 0.5);

    th {
      text-align: left;
      padding: 1rem;
      font-size: 0.875rem;
      font-weight: 500;
    }
  }

  tbody {
    tr {
      border-bottom: 1px solid var(--border-color);
      transition: background-color 0.2s;

      &:hover {
        background: rgba(var(--muted-bg-rgb), 0.3);
      }

      &.duplicate {
        opacity: 0.6;
        pointer-events: none;
      }
    }

    td {
      padding: 1rem;
      font-size: 0.875rem;

      &.amount {
        font-family: 'Courier New', monospace;
        font-size: 1.125rem;
        font-weight: 600;
        text-align: right;
      }

      &.date {
        font-family: 'Courier New', monospace;
        font-size: 0.875rem;
      }
    }
  }
}
```

**Badge Pattern (Section 6.6):**
```scss
.badge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 500;

  &.success {
    background: rgba(var(--success-color-rgb), 0.1);
    color: var(--success-color);
    border: 1px solid rgba(var(--success-color-rgb), 0.2);
  }

  &.destructive {
    background: rgba(var(--destructive-color-rgb), 0.1);
    color: var(--destructive-color);
    border: 1px solid rgba(var(--destructive-color-rgb), 0.2);
  }
}
```

**Alert/Snackbar Pattern (Section 6.12 - Alert Card):**
```scss
.snackbar {
  padding: 1rem;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;

  &.success {
    background: rgba(var(--success-color-rgb), 0.1);
    border: 1px solid rgba(var(--success-color-rgb), 0.2);
    color: var(--success-color-dark);
  }

  &.error {
    background: rgba(var(--destructive-color-rgb), 0.1);
    border: 1px solid rgba(var(--destructive-color-rgb), 0.2);
    color: var(--destructive-color-dark);
  }
}
```

### Translation from React Design Samples

[Source: docs/architecture/design-system.md - Section 10: Angular Implementation Guide]

**React Sample (Reference):**
```tsx
<div className="rounded-lg border border-border overflow-hidden">
  <table className="w-full">
    <thead className="bg-muted/50">
      <tr>
        <th className="text-left p-4 font-medium text-sm">Date</th>
      </tr>
    </thead>
  </table>
</div>
```

**Angular Implementation:**
```scss
.table-container {
  border-radius: 0.5rem;        // rounded-lg
  border: 1px solid var(--border-color);  // border border-border
  overflow: hidden;
}

table {
  width: 100%;                  // w-full

  thead {
    background: rgba(var(--muted-bg-rgb), 0.5);  // bg-muted/50

    th {
      text-align: left;         // text-left
      padding: 1rem;            // p-4
      font-weight: 500;         // font-medium
      font-size: 0.875rem;      // text-sm
    }
  }
}
```

### Current Implementation Context

[Source: Story 2.6 implementation]

**Files to Modify:**
- `src/Ledgerly.Web/src/app/features/import/import-csv.component.scss` - **PRIMARY FILE** for all styling changes
- `src/Ledgerly.Web/src/app/features/import/import-csv.component.html` - Minor changes only (add CSS classes if needed)
- `src/Ledgerly.Web/src/app/features/import/import-csv.component.spec.ts` - Update snapshot tests if HTML structure changes

**What NOT to Change:**
- **No TypeScript changes** - Component logic is correct, only styling needs refinement
- **No backend changes** - This is frontend-only
- **No functional behavior changes** - Editable fields, validation, API calls remain unchanged

### Visual Design Samples Location

**Design Samples Directory:** `docs/design-samples/src/`

**Relevant Files:**
- `docs/design-samples/src/pages/CsvImport.tsx` - React reference implementation of CSV import UI
- `docs/design-samples/src/components/ui/` - shadcn/ui components (Card, Button, Badge, Table)

**How to Use:**
1. Open design sample files to see visual patterns
2. Note: React code uses Tailwind CSS classes (e.g., `bg-accent`, `text-lg`)
3. Translate Tailwind patterns to SCSS using design system translation guide
4. Focus on visual result, not React-specific code

### Responsive Breakpoints

[Source: docs/architecture/design-system.md - Section 8: Responsive Design]

**Tailwind (Design Samples):**
- `sm:` 640px
- `md:` 768px
- `lg:` 1024px (primary desktop breakpoint)

**SCSS Translation:**
```scss
// Mobile-first (default styles are mobile)
.import-preview {
  padding: 1rem;  // Mobile padding

  @media (min-width: 768px) {
    padding: 1.5rem;  // Tablet padding
  }

  @media (min-width: 1024px) {
    padding: 1.5rem;  // Desktop padding
    // Grid changes, multi-column layouts
  }
}
```

### Accessibility Considerations

**Color Contrast (WCAG AA):**
- Ensure success text on success background meets 4.5:1 ratio
- Ensure error text on error background meets 4.5:1 ratio
- Test with browser DevTools color contrast analyzer

**Monospace Font Rationale:**
- Monetary amounts use monospace for alignment and readability (design principle from front-end-spec.md)
- Dates use monospace for technical data consistency

### Testing

[Source: architecture/test-strategy-and-standards.md]

**Unit Tests (Frontend):**
- **Framework:** Jest 29.7.0
- **Test Location:** `src/Ledgerly.Web/src/app/features/import/import-csv.component.spec.ts`
- **Changes Required:** Minimal - update snapshot tests if HTML structure changes

**Test Cases:**
- **Snapshot tests:** Update if component HTML changes (e.g., added CSS classes)
- **Accessibility tests:** Verify color contrast for success/error states (WCAG AA compliance)
- **Responsive tests:** Verify layout at mobile (375px), tablet (768px), desktop (1024px) breakpoints
- **No functional tests needed:** Styling changes don't affect component behavior

**Visual QA (Manual):**
- Side-by-side comparison: Current implementation vs. design samples
- Browser testing: Chrome, Firefox, Safari (ensure CSS custom properties supported)
- Responsive testing: Resize browser to test breakpoints
- Dark mode testing: If dark mode implemented, verify colors adapt correctly

### Known Constraints

**Angular Material Overrides:**
- Angular Material has default styling that may need overriding
- Use `::ng-deep` sparingly, prefer component-scoped styles
- Material Design spec differs from Ledgerly design system - prioritize Ledgerly design

**CSS Custom Properties Support:**
- Supported in all modern browsers (Chrome 49+, Firefox 31+, Safari 9.1+)
- No polyfill needed for MVP target browsers

**No Breaking Changes:**
- This story must not break existing functionality
- All Story 2.6 acceptance criteria must still pass after styling changes
- Integration tests should remain green (no functional changes)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-18 | 1.0 | Initial story creation for design system alignment. Refinement of Story 2.6 to match comprehensive design system patterns (typography, colors, spacing, component styling). Frontend-only, no functional changes. | Sarah (Product Owner) |
